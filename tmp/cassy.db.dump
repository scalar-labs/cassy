PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE backup_history (
    cluster_id VARCHAR(255) NOT NULL,
    target_ip VARCHAR(255) NOT NULL,
    snapshot_id VARCHAR(255) NOT NULL,
    created_at BIGINT NOT NULL,
    updated_at BIGINT, 
    backup_type TINYINT NOT NULL,
    status TINYINT NOT NULL,
    PRIMARY KEY (cluster_id, target_ip, snapshot_id, created_at)
);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.1','37ec5884-fcb8-4d29-be0a-b9eb6ac9a017',1589347799551,1589347801630,2,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.2','37ec5884-fcb8-4d29-be0a-b9eb6ac9a017',1589347799551,1589347801630,2,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.3','37ec5884-fcb8-4d29-be0a-b9eb6ac9a017',1589347799551,1589347801630,2,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.1','4b906187-23cc-4d8b-b4a1-23517195f3e7',1589347807271,1589347807273,1,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.1','4b906187-23cc-4d8b-b4a1-23517195f3e7',1589347807272,1589347807273,1,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.1','4b906187-23cc-4d8b-b4a1-23517195f3e7',1589347807273,1589347807273,1,4);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.1','15i39017-43ay-029x-ao7e-1040ce310r83',1589347807271,1589347807273,1,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.2','15i39017-43ay-029x-ao7e-1040ce310r83',1589347807272,1589347807273,1,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.3','15i39017-43ay-029x-ao7e-1040ce310r83',1589347807273,1589347807273,1,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.1','37ec5884-fcb8-4d29-be0a-b9eb6ac9a017',1589347834051,1589347834729,3,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.2','37ec5884-fcb8-4d29-be0a-b9eb6ac9a017',1589347834051,1589347834729,3,3);
INSERT INTO backup_history VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','127.0.0.3','37ec5884-fcb8-4d29-be0a-b9eb6ac9a017',1589347834051,1589347834729,3,4);
CREATE TABLE restore_history (
    cluster_id VARCHAR(255) NOT NULL,
    target_ip VARCHAR(255) NOT NULL,
    snapshot_id VARCHAR(255) NOT NULL,
    created_at BIGINT NOT NULL,
    updated_at BIGINT, 
    restore_type TINYINT NOT NULL,
    status TINYINT NOT NULL,
    PRIMARY KEY (cluster_id, target_ip, snapshot_id, created_at)
);
CREATE TABLE cluster_info (
    cluster_id VARCHAR(255) NOT NULL,
    cluster_name VARCHAR(255) NOT NULL,
    target_ips TEXT NOT NULL,
    keyspaces TEXT NOT NULL,
    data_dir TEXT NOT NULL,
    created_at BIGINT NOT NULL,
    updated_at BIGINT,
    PRIMARY KEY (cluster_id)
);
INSERT INTO cluster_info VALUES('TestCluster-78d3a9b8-1e22-4c2a-bc41-512e52d24745','TestCluster','127.0.0.1','system_distributed,system,system_schema,system_auth,system_traces,ist','/usr/local/var/lib/cassandra/data',1589347651246,1589347651246);
CREATE INDEX idx_snapshot_created_backup ON backup_history (snapshot_id, created_at);
CREATE INDEX idx_snapshot_created_restore ON restore_history (snapshot_id, created_at);
COMMIT;
